<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Email Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css?v=8">
</head>
<body>
  <div id="app">
    <!-- Auth Section (shown when not logged in) -->
    <div id="auth-section" class="auth-container">
      <div class="auth-card">
        <h1>Email Tracker</h1>
        <p class="subtitle">Track when your emails are opened</p>

        <div class="tabs">
          <button class="tab active" data-tab="login">Login</button>
          <button class="tab" data-tab="register">Register</button>
        </div>

        <!-- Login Form -->
        <form id="login-form" class="auth-form">
          <div class="form-group">
            <label for="login-email">Email</label>
            <input type="email" id="login-email" required placeholder="you@example.com">
          </div>
          <div class="form-group">
            <label for="login-password">Password</label>
            <input type="password" id="login-password" required placeholder="Your password" autocomplete="current-password">
          </div>
          <button type="submit" class="btn btn-primary">Login</button>
          <div id="login-error" class="error-message"></div>
        </form>

        <!-- Register Form -->
        <form id="register-form" class="auth-form hidden">
          <div class="form-group">
            <label for="register-name">Name</label>
            <input type="text" id="register-name" placeholder="Your name (optional)">
          </div>
          <div class="form-group">
            <label for="register-email">Email</label>
            <input type="email" id="register-email" required placeholder="you@example.com">
          </div>
          <div class="form-group">
            <label for="register-password">Password</label>
            <input type="password" id="register-password" required placeholder="Min 8 chars, 1 uppercase, 1 number" autocomplete="new-password">
          </div>
          <button type="submit" class="btn btn-primary">Create Account</button>
          <div id="register-error" class="error-message"></div>
        </form>
      </div>
    </div>

    <!-- Dashboard Section (shown when logged in) -->
    <div id="dashboard-section" class="dashboard hidden">
      <!-- Header -->
      <header class="header">
        <div class="header-left">
          <h1>Email Tracker</h1>
        </div>
        <div class="header-right">
          <span id="user-name" class="user-name"></span>
          <button id="logout-btn" class="btn btn-secondary">Logout</button>
        </div>
      </header>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Stats Cards -->
        <div class="stats-grid" id="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="stat-total">0</div>
            <div class="stat-label">Total Emails</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="stat-opened">0</div>
            <div class="stat-label">Opened</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="stat-opens">0</div>
            <div class="stat-label">Total Opens</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="stat-rate">0%</div>
            <div class="stat-label">Open Rate</div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="actions">
          <button id="create-tracking-btn" class="btn btn-primary">Create Tracking Pixel</button>
          <button id="compose-email-btn" class="btn btn-success">Compose & Send Email</button>
          <button id="gmail-connect-btn" class="btn btn-secondary">Connect Gmail</button>
        </div>

        <!-- Gmail Status -->
        <div id="gmail-status" class="gmail-status hidden">
          <span class="gmail-connected">Gmail Connected: <strong id="gmail-email"></strong></span>
          <button id="gmail-disconnect-btn" class="btn btn-small btn-danger">Disconnect</button>
          <p class="gmail-session-note">Session-based connection - reconnect after logout or server restart</p>
        </div>

        <!-- Emails Table -->
        <div class="emails-section">
          <h2>Tracked Emails</h2>
          <div class="table-container">
            <table id="emails-table">
              <thead>
                <tr>
                  <th>Subject</th>
                  <th>Recipient</th>
                  <th>Opens</th>
                  <th>Unique</th>
                  <th>Last Opened</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="emails-tbody">
                <tr><td colspan="6" class="empty-state">No tracked emails yet</td></tr>
              </tbody>
            </table>
          </div>
          <div id="pagination" class="pagination hidden"></div>
        </div>

        <!-- Recent Opens -->
        <div class="recent-opens-section">
          <h2>Recent Opens</h2>
          <div id="recent-opens" class="recent-opens-list">
            <p class="empty-state">No recent opens</p>
          </div>
        </div>
      </main>
    </div>

    <!-- Create Tracking Modal -->
    <div id="create-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Create Tracking Pixel</h2>
          <button class="modal-close">&times;</button>
        </div>
        <form id="create-form">
          <div class="form-group">
            <label for="create-subject">Email Subject</label>
            <input type="text" id="create-subject" required placeholder="What's the email about?">
          </div>
          <div class="form-group">
            <label for="create-recipient">Recipient Email</label>
            <input type="email" id="create-recipient" required placeholder="who@example.com">
          </div>
          <button type="submit" class="btn btn-primary">Generate Pixel</button>
        </form>
        <div id="pixel-result" class="pixel-result hidden">
          <h3>Your Tracking Pixel</h3>
          <p>Add this HTML to your email:</p>
          <div class="code-block">
            <code id="pixel-html"></code>
            <button id="copy-pixel" class="btn btn-small">Copy</button>
          </div>
          <p class="pixel-url-label">Or use this URL directly:</p>
          <div class="code-block">
            <code id="pixel-url"></code>
            <button id="copy-url" class="btn btn-small">Copy</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Compose Email Modal -->
    <div id="compose-modal" class="modal hidden">
      <div class="modal-content modal-large">
        <div class="modal-header">
          <h2>Compose & Send Email</h2>
          <button class="modal-close">&times;</button>
        </div>
        <div id="compose-gmail-warning" class="warning hidden">
          Please connect your Gmail account first to send emails.
        </div>
        <form id="compose-form">
          <div class="form-group">
            <label for="compose-to">To</label>
            <input type="text" id="compose-to" required placeholder="recipient@example.com (comma-separated for multiple)">
          </div>
          <div class="form-group">
            <label for="compose-cc">CC</label>
            <input type="text" id="compose-cc" placeholder="cc@example.com (optional, comma-separated)">
          </div>
          <div class="form-group">
            <label for="compose-bcc">BCC</label>
            <input type="text" id="compose-bcc" placeholder="bcc@example.com (optional, comma-separated)">
          </div>
          <div class="form-group">
            <label for="compose-subject">Subject</label>
            <input type="text" id="compose-subject" required placeholder="Email subject">
          </div>
          <div class="form-group">
            <label for="compose-body">Message</label>
            <textarea id="compose-body" required rows="10" placeholder="Write your email message here..."></textarea>
          </div>
          <div class="form-group">
            <label for="compose-attachments">Attachments</label>
            <input type="file" id="compose-attachments" multiple>
            <div id="attachment-list" class="attachment-list"></div>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-success" id="send-email-btn">Send with Tracking</button>
            <p class="help-text">A tracking pixel will be automatically added to your email.</p>
          </div>
        </form>
      </div>
    </div>

    <!-- Email Details Modal -->
    <div id="details-modal" class="modal hidden">
      <div class="modal-content modal-large">
        <div class="modal-header">
          <h2>Email Details</h2>
          <button class="modal-close">&times;</button>
        </div>
        <div id="email-details-content"></div>
      </div>
    </div>
  </div>

  <script src="/js/app.js?v=8"></script>
</body>
</html>
